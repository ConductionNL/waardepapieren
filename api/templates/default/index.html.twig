{% extends "content.html.twig" %}

{% block content %}

    {% set digispoof = commonground_cleanurl({"component":"ds"}) %}
    <div class="row">

        <div class="col-md-offset-1 col-md-10 col-sm-12">

            <div class="content-background">
                <div class="content">

                    <h2>Waardepapieren</h2>

                    {% if app.user|default %}

                        {% if not certificate|default %}

                            <form id="form" class="mb4" action="{{ url('app_default_paycertificate') }}" method="post">
                                <div class="input">
                                    <label class="input__label" for="typeSelect">Kies een waardepapier om te op te
                                        halen:</label>
                                    <select onchange="checkIfTypeHasPrice()" id="typeSelect" name="typeinfo"
                                            class="input__control input__control--xl input__control--select" required>
                                        <option value="{}" style="color: lightgrey;">Maak een keuze</option>
                                        {% for type in types %}
                                            <option
                                                value='{"type":"{{ type.type }}"{% if type.price|default %},"price":"{{ type.price }}"{% endif %}}'>{{ type.name }} {% if type.price|default %}&euro; {{ type.price }}{% endif %}</option>
                                        {% endfor %}
                                    </select>
                                </div>


                                <div class="input">
                                     <button id="submitButton" type="submit" class="btn btn--primary">Verder</button>
                                </div>
                            </form>
{#                            <form action="https://secure.ogone.com/ncol/test/orderstandard.asp" id="form1" method="post"#}
{#                                  name="form1">#}
{#                                <!-- algemene parameters -->#}
{#                                <input name="PSPID" type="hidden" value="gemhoorn" />#}
{#                                <input name="orderID" type="hidden" value="{{ uid }}" />#}
{#                                <input name="amount" id="amountInput" type="hidden" />#}
{#                                <input name="currency" type="hidden" value="EUR" />#}
{#                                <input name="language" type="hidden" value="nl_NL" />#}
{#                                <input name="CN" type="hidden" value="Barry" />#}
{#                                <input name="EMAIL" type="hidden" value="barry@conduction.nl" />#}
                                {# <input name="ownerZIP" type="hidden" value="" /> #}
                                {# <input name="owneraddress" type="hidden" value="" /> #}
                                {# <input name="ownercty" type="hidden" value="" /> #}
                                {# <input name="ownertown" type="hidden" value="" /> #}
                                {# <input name="ownertelno" type="hidden" value="" /> #}

{#                                <!-- controle voor de betaling-->#}
{#                                <input name="SHASign" id="SHASignInput" type="hidden"/>#}

{#                                <!-- layout informatie-->#}
{#                                <input name="TITLE" type="hidden" value="Certificate"/>#}
{#                                <input name="BGCOLOR" type="hidden" value="white"/>#}
{#                                <input name="TXTCOLOR" type="hidden" value="black"/>#}
{#                                <input name="TBLBGCOLOR" type="hidden" value="white"/>#}
{#                                <input name="TBLTXTCOLOR" type="hidden" value="black"/>#}
{#                                <input name="BUTTONBGCOLOR" type="hidden" value="white"/>#}
{#                                <input name="BUTTONTXTCOLOR" type="hidden" value="black"/>#}
{#                                <input name="LOGO" type="hidden" value="http://localhost/images/logo-hoorn.svg"/>#}
{#                                <input name="FONTTYPE" type="hidden" value="Verdana"/>#}


{#                                <!-- feedback na de betaling-->#}
                                {# <input name="accepturl" type="hidden" value="localhost?status=accepted"/> #}
                                {# <input name="declineurl" type="hidden" value="localhost?status=declined"/> #}
                                {# <input name="exceptionurl" type="hidden" value="localhost?status=exception"/> #}
                                {# <input name="cancelurl" type="hidden" value="localhost?status=cancelled"/> #}

{#                                <input id="accepturlInput" name="accepturl" type="hidden"#}
{#                                       value="{{ path(app.request.attributes.get('_route'),#}
{#                                           app.request.attributes.get('_route_params'))|trim('/', 'right') }}?status=accepted" />#}
{#                                <input id="declineurlInput" name="declineurl" type="hidden"#}
{#                                       value="{{ path(app.request.attributes.get('_route'),#}
{#                                           app.request.attributes.get('_route_params'))|trim('/', 'right') }}?status=accepted" />#}
{#                                <input id="exceptionurlInput" name="exceptionurl" type="hidden"#}
{#                                       value="{{ path(app.request.attributes.get('_route'),#}
{#                                           app.request.attributes.get('_route_params'))|trim('/', 'right') }}?status=accepted" />#}
{#                                <input id="cancelurlInput" name="cancelurl" type="hidden"#}
{#                                       value="{{ path(app.request.attributes.get('_route'),#}
{#                                           app.request.attributes.get('_route_params'))|trim('/', 'right') }}?status=accepted" />#}

{#                                <button disabled id="submit2" name="submit2" type="submit" value=""#}
{#                                        class="btn btn--primary">Test betaling#}
{#                                </button>#}
{#                            </form>#}

                        {% else %}

                            {% if certificate|default %}
                                {% include '/widgets/certificate.html.twig' with {
                                    'certificate': certificate
                                } %}
                            {% endif %}

                            {% if certificates|default %}
                                {% include '/widgets/certificates.html.twig' with {
                                    'certificates': certificates
                                } %}
                            {% endif %}




                        {# {% if certificates|default %} #}
                        {# {% for cert in certificates %} #}

                        {# {% include 'waardepapieren/widgets/download_modal.html.twig' with { #}
                        {# 'item': cert, #}
                        {# } %} #}

                        {# <script> #}
                        {# var downCert{{ cert.id|slice(0, 8) }}Modal; #}
                        {# // Load modal component #}
                        {# System.import('/uno/components/modal/modal.js').then(function (module) { #}
                        {# downCert{{ cert.id|slice(0, 8) }}Modal = new module.Modal(document.getElementById('downCert{{ cert.id }}Modal')); #}
                        {# }); #}

                        {# // Called when the user clicks the button #}
                        {# function openCert{{ cert.id|slice(0, 8) }}Modal() { #}
                        {# downCert{{ cert.id|slice(0, 8) }}Modal.open(); #}
                        {# } #}
                        {# </script> #}

                        {# {% endfor %} #}
                        {# {% endif %} #}

                    {% else %}
                        <p>In deze applicatie kunt u uw waardepapieren downloaden. <a class="pointer"
                                                                                      href="{{ digispoof }}{% if '?' in digispoof %}&{% else %}?{% endif %}responceUrl={{ url('app_user_digispoof') }}&backUrl={{ url('app_default_index') }}">Login</a>
                            om
                            te starten.</p>

                    {% endif %}

                </div><!-- /.content -->
            </div><!-- /.content-background -->
        </div><!-- /.col -->
    </div>

    <script>
        function checkIfTypeHasPrice() {
            // let submitButton = document.getElementById('submitButton');
            let typeSelect = document.getElementById('typeSelect');
            let submit2 = document.getElementById('submit2');
            let values = null;

            if (typeSelect.value != null) {
                values = JSON.parse(document.getElementById('typeSelect').value)
            }
            // let form = document.getElementById('form');
            if (values != null && values.price != null && values.price !== '' && values.price !== 0) {
                submit2.removeAttribute('disabled');

            } else {
                submit2.disabled = 'disabled';
            }
        }
    </script>

{% endblock %}
